<!doctype html>
{% load static %}
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Infra - SLEP Puerto Cordillera</title>
    <link rel="icon" type="image/png" href="{% static 'img/icono_32.svg' %}"/>
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    {% comment %} <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">   {% endcomment %}
    <!-- Implementacion Data Table-->
	<link rel="stylesheet" type="text/css" href="{% static 'libs/datatable/css/bootstrap.min.css' %}"/>
	<link rel="stylesheet" type="text/css" href="{% static 'libs/datatable/css/dataTables.bootstrap5.min.css' %}"/>
    <!-- Sidebars CSS -->
    <link href="{% static 'css/sidebars.css' %}" rel="stylesheet">  
    <!-- Implementacion Loader CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/loader.css' %}" media="all" />
    <!-- Implementacion Toast CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'libs/toast/toastr.min.css' %}" media="all" />
    <!-- Font Icons fontawesome -->
    <link rel="stylesheet" type="text/css" href="{% static 'libs/fontawesome/css/all.css' %}" media="all" />
    <!----===== Boxicons CSS ===== -->
    <link rel="stylesheet" href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' media="all">
    <!-- Select 2 -->
{% comment %}     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
     {% endcomment %}{% block head %}{% endblock %}
  <style>
    /* Google Font Import - Poppins */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    *{
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
    }
    body{
        min-height: 100vh;
        background-color: #f6f8fc     
    }
    .sidebar{
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        width: 250px;
        padding: 10px 14px;
        background: white;
        z-index: 100;  
    }
    .content{
        padding-left: 15px;
        padding-right: 15px;
        padding-top: 0px;
        padding-bottom: 60px;
        margin-bottom: 30px;
    }
    .home{
        position: absolute;
        top: 0;
        top: 0;
        left: 250px;
        height: 100vh;
        width: calc(100% - 250px);
    }
    .title{
        font-size: 18px;
        font-weight: 500;
        color: #707070;    
    }
    .sub-titulo {
        color: #707070;
    }
    .logo {
        color: #ff7f07;
        font-size: 25px;
        
    }
    .card {
        border: none !important;
        border-radius: 10px !important;
        font-size: 13px !important;
    }

    .card-body {
        padding-bottom: 35px !important;    
    }
    .btn-user {
        border-radius: 50% !important; 
        text-align: center !important; 
        padding: 4px !important; 
        width: 35px !important; 
        height: 35px !important;
        font-size: 14px !important;
        background-color: #0F828F !important; 
        border: none !important;
        user-select: none;
    }
    .btn-round {
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 35px; 
        width: 35px;
        margin-right: 10px;
        background: #F6F5FF;
        text-decoration: none;
        user-select: none;
        font-size: 22px;
        color: #5f6368;
        &:hover {
            background-color: #707070;
            color: #ffffff;
        };
        &:active {
            background-color: #707070;
            color: #ffffff;
        };

    }

    .estado_s_e {
    color: 	#FFFFFF;
    background-color: #6c757d;
    }
    .estado_bf {
        color: 	#FFFFFF;
        background-color: #198754;
    }
    .estado_ffl {
        color: 	#0F5132;
        background-color: #badbcc;
    }
    .estado_fr {
        color: #212529;
        background-color: #ffc107;
    }
    .estado_mf {
        color: #FFFFFF;
        background-color: #dc3545;
    }

    .estado_me {
        color: #74111a;
        background-color: #f5c2c7;
    }


    .estado_nee {
        color: #212529;
        background-color: #0dcaf0;
    }
    .estado_ne {
        color: #212529;
        background-color: #f8f9fa;
    }


    .pagination {
        --bs-pagination-font-size: 0.75rem !important;
    }

    .div-filter {            
            box-shadow: 0 1px 2px 0 rgb(60 64 67 / 30%), 0 2px 6px 2px rgb(60 64 67 / 15%);
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 0.2rem;
        }
    
    
        
    .dropdown-menu li .dropdown-item {
        border-radius: 6px !important;
        padding: 8px 15px !important;
        font-size: 14px;
        display: flex;
        align-items: center;
        /* &:hover{
            background-color: var(--secondary-color-light);        
            color: var(--primary-color);
        }  */  
    }
    /* body.dark .dropdown-menu li .dropdown-item {
        color: var(--text-color);     
        &:hover{
            background-color: var(--primary-color-light);       
        } 

    } */

    .dropdown-menu li .dropdown-item i {
        font-size: 20px;
        padding-right: 12px;
    }
    .btn-sm {
        font-size: 13px !important;
    }

    .btn-sm i {
        padding-right: 5px !important;
    }
    .alert{
        padding: 5px 10px;
        
    } 
  </style>
  <style>
    .select2-container--bootstrap-5 .select2-dropdown .select2-results__options .select2-results__option {
        padding: .375rem .75rem;
        font-size: 13px;
    }

    .select2-container--bootstrap-5 .select2-dropdown .select2-search .select2-search__field {
        padding: .375rem .75rem;
        font-size: 13px;
    }
</style>

<!-- <style>
    .div_title {
        width: 100%; 
        color: rgb(255, 255, 255);
        background-image: linear-gradient(to right, #757575, #0d6dfd42); 
        padding: 3px 10px; 
        font-size: 14.5px; 
        font-weight: 500;
        border-radius: 3px;
        margin-bottom: 15px;
    }
</style> -->
<style>
    .div_title {
        width: 100%;
        border-bottom: 1px solid #afafaf; 
        padding: 3px 6px; 
        font-size: 19px; 
        font-weight: 600;        
        margin-bottom: 15px;
    }
    /* Get Htmx */
    .div-get-htmx {
        display: flex;
        justify-content: center;
        align-items: center;
    }

</style>
</head>

<body>     
    <div id="contenedor_carga">
      <div id="carga"></div>
    </div>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
        </symbol>
        <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
        </symbol>
        <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
        </symbol>
    </svg>
    
    {% include 'sidebar.html' %}
    <div class="home">
        <div class="d-flex align-items-center" style="min-height: 60px; padding-right: 20px; padding-left: 25px;">
            <div class="flex-grow-1">                
                <div class="title">{{title_nav}}</div>
            </div>
            <div class="d-flex align-items-center">
                <a class="btn-round" type="button" href="#"><i class='bx bx-help-circle'></i></a>
                <a class="btn-round" type="button" href="#"><i class='bx bx-bell'></i></a>
                <a class="btn-round" type="button" href="#"><i class='bx bx-cog'></i></a>               
                <div class="btn-group">
                    <button class="btn btn-secondary btn-user" data-bs-toggle="dropdown" aria-expanded="false">
                        {{request.user.iniciales}}
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" style="min-width: 270px !important; width: 270px !important; padding-left: 10px; padding-right: 10px; ">
                        <li class="dropdown-menu-title">
                            <div class="text-truncate" style="line-height: 20px;padding-left: 10px; padding-right: 10px;">                                
                                <strong>{{request.user.nombre_completo}}</strong>
                                <br>
                                <span style="font-size: 13px;">{{request.session.usuario_entidad.email}}</span>
                                <br>
                            </div>
                        </li>
                        <li><a class="dropdown-item" type="button" href="#"><i class="fa-regular fa-arrows-rotate"></i> Cambiar Entidad</a></li>



                        
                        <!-- <li><button class="dropdown-item" type="button"><i class='bx bx-cog' ></i>Configuración personal</button></li>
                        <li><button class="dropdown-item" type="button"><i class='bx bx-bell icon'></i>Notificaciones personales</button></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="dropdown-menu-title">                            
                            <div class="text-truncate" style="line-height: 20px;">
                                <strong>{{request.session.empresa}}</strong>
                            </div>
                        </li>
                        <li><a class="dropdown-item" type="button" href="#"><i class='bx bx-buildings'></i>Perfil Empresa</a></li>                      
                        <li><button class="dropdown-item" type="button"><i class='bx bx-cart-alt'></i>Servicios contratados</button></li>
                        <li><a class="dropdown-item" type="button" href="#"><i class='bx bx-user-pin'></i>Gestión de usuarios</a>
                        </li>
                        <li><button class="dropdown-item" type="button"><i class='bx bx-bell icon'></i>Notificaciones</button></li>                        
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" type="button" href="#"><i class='bx bx-transfer-alt'></i>Cambiar de Empresa</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li> -->
                        <li>
                            <form action="{% url 'logout' %}" method="post">
                                {% csrf_token %}
                                <button class="dropdown-item" type="submit"><i class='bx bx-log-out-circle'></i>Cerrar Sesión</button>
                            </form>                        
                        </li>
                    </ul>
                </div>
            </div>            
        </div>
        <div class="content">
            <div class="card">
                <div class="card-body">
                    {% block content %}{% endblock %}
                </div>
            </div>
        </div>

    </div>
    <div id="ventana_modal" class="modal fade" role="dialog"></div>  
    
 
    {% comment %} <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script> {% endcomment %}
    <!-- Jquery -->
    <script src="{% static 'libs/jquery/jquery.min.js' %}"></script>
    <!-- Js Siderbar -->
    <script src="{% static 'js/sidebars.js' %}"></script>
    <!-- Implementacion Loader-->
    <script src="{% static 'js/loader.js' %}" type="text/javascript"></script>
    <!-- Implementacion jquery_chained para select JS -->
    <script src="{% static 'js/jquery.chained.js' %}" type="text/javascript"></script>
    <!-- htmx -->
    <!-- <script src="https://unpkg.com/htmx.org@2.0.3" integrity="sha384-0895/pl2MU10Hqc6jd4RvrthNlDiE9U1tWmX7WRESftEDRosgxNsQG/Ze9YMRzHq" crossorigin="anonymous"></script> -->
    <script src="{% static 'libs/htmx/htmx.min.js' %}"></script>
         <!-- Implementacion Data Table-->
    <script src="{% static 'libs/datatable/js/jquery.dataTables.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'libs/datatable/js/dataTables.bootstrap5.min.js' %}" type="text/javascript"></script>
    <script>
    $(document).ready(function () {
        $('#datatable').DataTable(
            {
                language: {
                    "decimal": "",
                    "emptyTable": "No hay información",
                    "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                    "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                    "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "Mostrar _MENU_ Entradas",
                    "loadingRecords": "Cargando...",
                    "processing": "Procesando...",
                    "search": "Buscar:",
                    "zeroRecords": "Sin resultados encontrados",
                    "paginate": {
                        "first": "Primero",
                        "last": "Ultimo",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    }
                }
            }
        );
    });
    $(document).ready(function () {
        $('#ver_cdps_table').DataTable(
            {
                language: {
                    "decimal": "",
                    "emptyTable": "No hay información",
                    "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                    "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                    "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "Mostrar _MENU_ Entradas",
                    "loadingRecords": "Cargando...",
                    "processing": "Procesando...",
                    "search": "Buscar:",
                    "zeroRecords": "Sin resultados encontrados",
                    "paginate": {
                        "first": "Primero",
                        "last": "Ultimo",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    }
                }
            }
        );
    });
    </script>
    <!-- select2 -->
    {% comment %} <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script> {% endcomment %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.full.min.js"></script>
    <script>
        $('.select-field').select2({
            theme: 'bootstrap-5'
        });
    </script>
    <script>
        $(document).ready(function() {
            // Inicializa los select con Select2
            if ($('.select-field-rc').length) {
                $('.select-field-rc').select2({
                    theme: 'bootstrap-5',
                    placeholder: 'Seleccione...'
                });
    
                // Evento select2:select, se dispara cuando se selecciona una opción
                $('.select-field-rc').on('select2:select', function(e) {
                    var value = $(this).val();
                    if (value && value !== '0') {
                        $(this).next('.select2-container').find('.select2-selection').addClass('select2-selection--valid');
                    } else {
                        $(this).next('.select2-container').find('.select2-selection').removeClass('select2-selection--valid');
                    }
                });
    
                // Evento select2:unselect, se dispara cuando se deselecciona una opción
                $('.select-field-rc').on('select2:unselect', function(e) {
                    $(this).next('.select2-container').find('.select2-selection').removeClass('select2-selection--valid');
                });
    
                // Inicializar el estado de los selects (validación inicial)
                $('.select-field-rc').each(function() {
                    var value = $(this).val();
                    if (value && value !== '0') {
                        $(this).next('.select2-container').find('.select2-selection').addClass('select2-selection--valid');
                    } else {
                        $(this).next('.select2-container').find('.select2-selection').removeClass('select2-selection--valid');
                    }
                });
            }
    
            // Captura el evento submit del formulario
            const form = document.querySelector('#profesor_form');  // Asegúrate de que el formulario tenga este ID.
            
            if (form) {
                form.addEventListener('submit', function(event) {
                    let valid = true;  // Variable para controlar si la validación pasa
                    
                    // Captura todos los selects de Select2
                    const selectFields = form.querySelectorAll('.select-field-rc');
                    
                    // Itera sobre los selects y valida si el valor es la opción por defecto
                    selectFields.forEach(select => {
                        const value = $(select).val(); // Usamos jQuery para obtener el valor
                        // Aquí verificamos si el valor es la opción por defecto
                        if (value === '' || value === '0') {
                            valid = false; // Si el valor es inválido, marcamos como no válido
                            $(select).next('.select2-container').find('.select2-selection').addClass('select2-selection--invalid');  // Opcional: añade una clase para resaltar el error
                        } else {
                            $(select).next('.select2-container').find('.select2-selection').removeClass('select2-selection--invalid');
                        }
                    });
    
                    // Si alguna de las validaciones no pasó, prevenimos el envío del formulario
                    if (!valid) {
                        event.preventDefault();  // Previene el envío del formulario
                        alert('Por favor, selecciona una comuna o región válida.');  // Muestra un mensaje de advertencia
                    }
                });
            }
        });
    </script>
    
    
    <script>
        // Inicializa Select2 con el tema Bootstrap 5
        $('.select-field-establecimiento').select2({
            theme: 'bootstrap-5'
        });
    
        // Cambiar el color del fondo al cambiar la selección
        $('#establecimiento').on('change', function () {
            const establecimiento = $(this).val();
    
            // Obtén el contenedor de Select2 generado
            const select2Container = $(this).next('.select2-container');
    
            if (establecimiento && establecimiento !== 'todos') {
                // Cambiar el color de fondo
                select2Container.find('.select2-selection').css('background-color', 'rgba(183, 225, 239, 0.5)');
                $('#establecimientoForm').submit();
            } else {
                // Restaurar el color por defecto
                select2Container.find('.select2-selection').css('background-color', '');
                alert('Por favor, selecciona un año válido.');
            }
        });
    
        // Configurar el color inicial basado en el valor seleccionado
        $(document).ready(function () {
            const initialValue = $('#establecimiento').val();
            const select2Container = $('#establecimiento').next('.select2-container');
    
            if (initialValue && initialValue !== 'todos') {
                select2Container.find('.select2-selection').css('background-color', 'rgba(183, 225, 239, 0.5)');
            }
        });
    </script>
    
    <script>
        $(".select-estado").select2({
            placeholder: 'Seleccione...',
            maximumSelectionLength: 2,
            multiple: true,  // Esto permite selección múltiple
            dropdownCssClass: 'no-input'
            
          });
    </script>
    
    <!-- Implementacion Toast JS-->
    <script src="{% static 'libs/toast/toastr.min.js' %}" type="text/javascript"></script>
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'success'%}
                <script type=text/javascript>toastr.{{message.tags}}('{{message}}')</script>
            {% elif message.tags == 'info' %}
                <script type=text/javascript>toastr.{{message.tags}}('{{message}}')</script>
            {% elif message.tags == 'warning' %}
                <script type=text/javascript>toastr.{{message.tags}}('{{message}}')</script>
            {% elif message.tags == 'error' %}
                <script type=text/javascript>toastr.{{message.tags}}('{{message}}')</script>
            {% endif %}
        {% endfor %}
    {% endif %}
    <script>
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    </script>
    <script>
        var $ = jQuery.noConflict();
        $(".abrir_modal").click(function(ev) {
        ev.preventDefault();
        var url = $(this).data("form");
        $("#ventana_modal").load(url, function() {
            $(this).modal({
                backdrop: 'static',
                keyboard: false
            });
            $(this).modal('show');
        });
        return false;
        });
    </script>
    {% block jscript %}{% endblock %}  
</body>
</html>